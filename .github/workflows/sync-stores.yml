name: Ignore JSON files in haymes-test folder
 
on:

  pull_request:

    branches:

      - store-dev

    paths:

      - '**'
 
jobs:

  check-files:

    runs-on: ubuntu-latest

    steps:

      - name: Checkout code

        uses: actions/checkout@v4

        with:

          fetch-depth: 0
 
      - name: Get changed files

        id: changed-files

        uses: tj-actions/changed-files@v41

        with:

          files_ignore: |

            haymes-test/**/*.json
 
      - name: Check for relevant changes

        id: check-changes

        run: |

          if [ "${{ steps.changed-files.outputs.any_changed }}" == "false" ]; then

            echo "Only JSON files in haymes-test folder were modified. No relevant changes to review."

            echo "skip_review=true" >> $GITHUB_OUTPUT

          else

            echo "Found changes outside haymes-test JSON files. PR should be reviewed."

            echo "skip_review=false" >> $GITHUB_OUTPUT

          fi
 
      - name: Comment on PR

        if: steps.check-changes.outputs.skip_review == 'true'

        uses: actions/github-script@v7

        with:

          script: |

            github.rest.issues.createComment({

              issue_number: context.issue.number,

              owner: context.repo.owner,

              repo: context.repo.repo,

              body: '⚠️ This PR only contains changes to JSON files in the `haymes-test` folder, which are ignored per repository policy. No review required for these changes.'

            })
 
      - name: Auto-approve if only ignored files

        if: steps.check-changes.outputs.skip_review == 'true'

        uses: actions/github-script@v7

        with:

          script: |

            github.rest.pulls.createReview({

              owner: context.repo.owner,

              repo: context.repo.repo,

              pull_number: context.issue.number,

              event: 'APPROVE',

              body: 'Auto-approved: Only ignored JSON files in haymes-test folder were modified.'

            })
 
