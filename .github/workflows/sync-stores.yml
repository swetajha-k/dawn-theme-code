name: Sync store-dev → store-stage (Exclude JSON)
 
on:
  push:
    branches:
      - store-dev
 
jobs:
  sync-branches:
    runs-on: ubuntu-latest
 
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
 
      - name: Configure Git
        run: |
          git config user.name "sweta"
          git config user.email "sweta@gmail.com"
 
      - name: Checkout store-stage branch
        run: |
          git checkout store-stage
 
      - name: Sync store-dev → store-stage (exclude JSON)
        run: |
          # Create a clean worktree of store-dev
          git worktree add /tmp/store-dev store-dev
 
          # Sync files but EXCLUDE JSON
          rsync -av --delete \
            --exclude='config/*.json' \
            --exclude='.git' \
            /tmp/store-dev/ ./
 
          # Remove temp worktree
          rm -rf /tmp/store-dev
 
      - name: Commit and push changes
        run: |
          git status
          git add .
          git diff --cached --quiet || git commit -m "Sync from store-dev to store-stage (excluding JSON)"
          git push origin store-stage
